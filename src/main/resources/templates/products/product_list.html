<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Kotlin Spring Demo - ì œí’ˆ ëª©ë¡</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"/>
</head>
<body class="container mt-5">
<h1 class="text-center mb-4">ì œí’ˆ ëª©ë¡</h1>
<table class="table table-striped table-bordered">
    <thead class="thead-dark">
    <tr>
        <th>#</th>
        <th>Name</th>
        <th>Price</th>
        <th>Event</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="product, iterStat : ${products}">
        <td th:text="${iterStat.count}"></td>
        <td>
            <a th:href="@{/products/{id}(id=${product.id})}" th:text="${product.name}"></a>
        </td>
        <td th:text="${product.price + 'ì›'}"></td>
        <td>
            <span th:onclick="'deleteProduct(this, ' + ${product.id} + ')'">ğŸ—‘</span>
        </td>
    </tr>
    </tbody>
</table>
<div class="text-center mt-4">
    <a th:href="@{/products/new}" class="btn btn-primary">ì œí’ˆ ë“±ë¡í•˜ê¸°</a>
</div>
</body>
</html>

<script>
    // ì œí’ˆ ì‚­ì œ
    const deleteProduct = (button, productId) => {
        fetch(`/products/${productId}`, {method: 'DELETE'})
            .then((response) => {
                console.log(response)
                if (!response.ok) {
                    throw new Error("ì œí’ˆ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
                }
                // í•´ë‹¹ ë²„íŠ¼ì˜ í–‰ì„ DOMì—ì„œ ì œê±°
                const row = button.closest('tr');
                if (row) {
                    row.remove();
                    updateRowNumbers();
                }
            })
            .catch((error) => {
                console.error("ì œí’ˆ ì‚­ì œ ë„ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")
                console.error(error)
            })
    }

    // í–‰ ë²ˆí˜¸ ì—…ë°ì´íŠ¸
    const updateRowNumbers = () => {
        // ëª¨ë“  í–‰ì„ ë‹¤ì‹œ ì¡°íšŒ
        const rows = document.querySelectorAll('tbody tr');
        rows.forEach((row, index) => {
            // ê° í–‰ì˜ ì²« ë²ˆì§¸ <td>ì— ë‹¤ì‹œ ë„˜ë²„ë§
            const td = row.querySelector('td');
            if (td) {
                td.textContent = (index + 1).toString();
            }
        });
    };
</script>